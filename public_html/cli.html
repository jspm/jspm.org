<!DOCTYPE html><html lang="en"><head><meta property="og:title" content="jspm.org - jspm 3.0 CLI"><meta property="og:image" content="https://jspm.org/jspm.png"><meta name="Description" content="jspm 3.0 CLI documentation"><meta property="og:description" content="jspm 3.0 CLI documentation"><meta property="og:url" content="https://jspm.org/cli"><meta name="twitter:card" content="summary_large_image"><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/style.css">
<link rel="preload" as="font" href="/sourcesans.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/sourcesans-light.woff2" type="font/woff2" crossorigin="anonymous">
<script defer="" src="/script.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-40327700-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-40327700-2');
</script>
<title>jspm 3.0 CLI - jspm.org</title></head><body class="page-cli">
<div class="topbar">
  <a style="display: block" href="/">
    <div class="logobox" href="/"></div>
    <h1 class="logo">jspm</h1>
  </a>
  <ul class="toplinks">
    <li><a href="/jspm-dev-release">Latest Release</a></li>
    <li><a href="/">jspm.dev</a></li>
    <li><a href="/sandbox">Sandbox</a></li>
    <li class="github"><a target="_blank" href="https://github.com/jspm/project" rel="noopener"></a></li>
  </ul>
  <div class="mobile-menu"></div>
</div>
<div class="sidebar">
  <div class="toc">
    <ul class="sections">
      <li class="docs">
        <a href="/">Docs</a>
        <ul class="section">
          <li class="guide"><a href="/">jspm.dev</a></li>
        </ul>
      </li>
      <li><a>Resources</a>
      <ul>
        <li><a href="/sandbox">Online Sandbox</a></li>
        <li><a target="_blank" href="https://github.com/jspm/project" rel="noopener">Issue Tracker</a></li>
        <li><a target="_blank" href="https://discord.gg/dNRweUu" rel="noopener">Discord</a></li>
        <li><a target="_blank" href="https://opencollective.com/jspm" rel="noopener">Open Collective</a></li>
        <li><a target="_blank" href="https://twitter.com/jspm" rel="noopener">@jspm on Twitter</a></li>
      </ul>
      </li>
      <li class="about">
        <a>Posts</a>
        <ul class="section">
          <li class="jspm-dev"><a href="/jspm-dev-release"><em>19/06/20 • jspm.dev Release</em></a></li>
        </ul>
      </li>
    </ul>
  </div>
  <div class="footer"><p>
    Logo design by <a target="_blank" href="https://www.luuk.site/" rel="noopener">Luuk de Vlieger</a>
  </p></div>
</div>
<div class="content"><h1>jspm 3.0 CLI Release Preview</h1>
<blockquote>
<p>Thank you for testing the jspm 3.0 CLI private release preview!<br>NOTE: DO NOT SHARE THIS PAGE PUBLICLY</p>
</blockquote>
<a name="getting-started" class="anchor"></a><h2>Getting Started</h2>
<p>This guide will follow through a very simple scenario of adding web component packages, running them in the browser, then building for SystemJS.</p>
<p>For build and setup instructions see the main CLI repo readme file.</p>
<h3>Adding Packages</h3>
<p>To add any package from npm, use <code>jspm add</code>. This command also supports subpaths of packages.</p>
<p>For the example, add a web component to start:</p>
<pre><code>jspm add @material/mwc-button</code></pre>
<p>This will populate these packages into the file at <code>jspm.importmap</code>.</p>
<h3>Setting up the HTML</h3>
<p>To run these packages in Chrome with the <em>Experimental Web Platform Features</em> flag, first setup the boilerplate HTML page:</p>
<p>app.html</p>
<pre><code class="language-html">&lt;!doctype html&gt;
&lt;script type=<span class="string">"importmap"</span>&gt;
&lt;/script&gt;
&lt;script type=<span class="string">"module"</span>&gt;
<span class="keyword">import</span> <span class="string">'@material/mwc-button'</span>;
&lt;/script&gt;
&lt;body&gt;
  &lt;mwc-button @click=<span class="string">"${<span class="keyword">this</span>.openDialog}"</span> label=<span class="string">"Click Me!"</span> raised&gt;&lt;/mwc-button&gt;
&lt;/body&gt;</code></pre>
<p>Ideally, we would use <code>&lt;script type=<span class="string">"importmap"</span> src=<span class="string">"jspm.importmap"</span>&gt;</code> in the above, but unfortunately Chrome doesn't yet support this.</p>
<p>Instead we need to tell jspm to copy the importmap into our HTML page. We can do this with the <code>--out</code> flag of <code>jspm install</code>:</p>
<pre><code>jspm install -o app.html</code></pre>
<p>This tells jspm to copy every installed package into the <code>app.html</code> import map.</p>
<blockquote>
<p>The distinction between <code>jspm install</code> and <code>jspm add</code> is just like Yarn - <code>add</code> creates a new entry in the import map, while <code>install</code> will validate the whole existing install tree.</p>
</blockquote>
<p>The <code>&lt;script type=<span class="string">"importmap"</span>&gt;</code> section in the HTML file will now be populated.</p>
<h3>Running the app</h3>
<p>Use any local HTTP server to run the app.</p>
<p>For <code>http-server</code> try:</p>
<pre><code>npx http-server -c-1</code></pre>
<blockquote>
<p>The <code>-c-1</code> flag here is important so the HTTP server doesn't cache the local files as we make changes.</p>
</blockquote>
<p>Navigate to <code>http://localhost:8080/app.html</code> in the browser to see the functional web component application.</p>
<p><em>That's the overall workflow for developing apps with modules!</em></p>
<h3>Dynamic Import</h3>
<p>Let's add some new packages to this application, but this time instead of copying the <code>jspm.importmap</code> we can actually add a new package directly into the page import map itself:</p>
<pre><code>jspm add -m app.html lit-element @material/mwc-dialog</code></pre>
<blockquote>
<p>The <code>-m</code> (or <code>--import-map</code>) flag tells jspm which import map to install / add into, which can be any JSON or HTML page with an import map.</p>
</blockquote>
<p>Let's create our own web component in a new JS module called <code>app.js</code>:</p>
<pre><code class="language-js">```js
<span class="keyword">import</span> <span class="string">'@material/mwc-button'</span>;
<span class="keyword">import</span> { LitElement, html } <span class="keyword">from</span> <span class="string">'lit-element'</span>;
class MyApp extends LitElement {
  static get properties() {
    <span class="keyword">return</span> {
      dialogOpen: { type: Boolean }
    };
  }
  <span class="keyword">async</span> openDialog () {
    <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'@material/mwc-dialog'</span>);
    <span class="keyword">this</span>.dialogOpen = <span class="keyword">true</span>;
  }
  render() {
    <span class="keyword">return</span> html`
      &lt;mwc-button @click=<span class="string">"${<span class="keyword">this</span>.openDialog}"</span> label=<span class="string">"Click Me!"</span> raised&gt;&lt;/mwc-button&gt;
      ${<span class="keyword">this</span>.dialogOpen ? html`
        &lt;mwc-dialog id=<span class="string">"myDialog"</span> open @closed=${() =&gt; <span class="keyword">this</span>.dialogOpen = <span class="keyword">false</span>}&gt;
          &lt;div&gt;Discard draft?&lt;/div&gt;
          &lt;mwc-button slot=<span class="string">"primaryAction"</span> dialogAction=<span class="string">"discard"</span>&gt;Discard&lt;/mwc-button&gt;
          &lt;mwc-button slot=<span class="string">"secondaryAction"</span> dialogAction=<span class="string">"cancel"</span>&gt;Cancel&lt;/mwc-button&gt;
        &lt;/mwc-dialog&gt;
      ` : <span class="string">''</span>}
    `;
  }
}
customElements.define(<span class="string">'my-app'</span>, MyApp);</code></pre>
<p>To load and use this component, remove the previous <code>&lt;script type=<span class="string">"module"</span>&gt;</code> tag and add the following to the HTML page:</p>
<pre><code class="language-html">&lt;script type=<span class="string">"module"</span> src=<span class="string">"app.js"</span>&gt;
&lt;body&gt;
  &lt;my-app&gt;&lt;/my-app&gt;
&lt;/body&gt;</code></pre>
<p>Try it out with the same HTTP server to see this in action.</p>
<p>Note the dynamic import <code><span class="keyword">await</span> <span class="keyword">import</span>('@material/mwc-dialog)</code> loads the dialog component only when the button is pressed.</p>
<h3>SystemJS Conversion</h3>
<p>To run this application in browsers that don't support import maps (most browsers), we need to convert the application into SystemJS.</p>
<p>To do this we need to:</p>
<ol>
<li>Update the import map to reference SystemJS modules</li>
<li>Include SystemJS in the page</li>
<li>Build our local code into the SystemJS module format</li>
<li>Reference our built SystemJS code</li>
</ol>
<h4>1. Switching to System Import Map</h4>
<p>To convert the import map to run against the SystemJS CDN use the following command:</p>
<pre><code>jspm install --system -m app.html</code></pre>
<p>This tells jspm to install the entire import map, but to switch into the SystemJS CDN mode. The import map is used from the <code>app.html</code> file and saved back into this file.</p>
<p>All references to <code>https://ga.jspm.io</code> will then be converted into references to <code>https://system.ga.jspm.io</code>.</p>
<h4>2. Including SystemJS</h4>
<p>SystemJS can be included in any way you like, but if you want to use the version from the jspm CDN, use the following command to get the script tag HTML:</p>
<pre><code>jspm locate systemjs/s.js --system -c</code></pre>
<p>Which outputs:</p>
<pre><code class="language-html">&lt;script src=<span class="string">"https://ga.system.jspm.io/npm:systemjs@<span class="number">6</span>.<span class="number">6</span>.<span class="number">1</span>/dist/s.min.js"</span> integrity=<span class="string">"sha384-fNLxbFH<span class="number">9</span>hT<span class="number">5</span>mhtd6OSPEPv8pEHS<span class="number">8</span>nFVmSwXSbDfJLVR<span class="number">35</span>y4+<span class="number">4</span>bxpsYf/Ui3D<span class="number">0</span>Af6"</span> crossorigin=<span class="string">"anonymous"</span>&gt;&lt;/script&gt;</code></pre>
<p>Copy this script tag into the top of the <code>app.html</code> HTML page above the import map.</p>
<ul>
<li>The <code>--system</code> flag makes sure to use SystemJS from the <code>https://system.ga.jspm.io</code> CDN so we use the same CDN.</li>
<li>The <code>-c</code> flag copies the result to the clipboard so we can easily paste it into the page.</li>
<li>The <code>-f</code> flag can customize the output of the locate command, eg <code>-f style</code> is another option useful for locating stylesheets in packages.</li>
<li>By default the script tag includes integrity. This can be disabled with <code>--no-integrity</code>.</li>
</ul>
<blockquote>
<p><code>s.js</code> is a smaller SystemJS build we are referencing here. This is available as it is in the <code><span class="string">"exports"</span></code> field for SystemJS.<br>To list the exports field for any package, you can use <code>jspm ls systemjs</code> to see what is available in the exports for a package.</p>
</blockquote>
<h4>3. Building an Application for SystemJS</h4>
<p>To build our local <code>app.js</code> file into SystemJS, use <code>jspm build</code>:</p>
<pre><code>jspm build ./app.js -f system</code></pre>
<p>This will output the built SystemJS module to <code>dist/app.js</code>.</p>
<ul>
<li><code>-f system</code> tells it to build for SystemJS. Otherwise ES modules are assumed by default.</li>
<li>The <code>./</code> before <code>./app.js</code> <strong>is important to include</strong>, otherwise it will think we are trying to build a package called <code>app.js</code>. This works just like module specifiers themselves.</li>
<li>Use <code>--watch</code> or <code>-w</code> for a watched build.</li>
<li>There are many other build options, see the <code>src/cli.ts</code> file for more info.</li>
</ul>
<blockquote>
<p>Note that <code>jspm build</code> will do full build chunking for multiple entry points and dynamic imports.</p>
</blockquote>
<h4>4. Referencing the SystemJS Build</h4>
<p>Update the HTML page to refer to this SystemJS build instead of the <code>app.js</code> module from before:</p>
<pre><code class="language-html">&lt;script src=<span class="string">"dist/app.js"</span>&gt;&lt;/script&gt;</code></pre>
<p>Note that the script tag should not use <code><span class="string">"type"</span>: <span class="string">"module"</span></code> as we are loading a SystemJS module instead.</p>
<p><em>Loading the same page in the browser, we now have an application that will work in all older browsers via SystemJS.</em></p>
<h3>Cast Optimization</h3>
<p>The jspm CDNs are highly optimized for production - each package is built and minified and served with far future expires, compression and HTTP/2 over Google Cloud CDN for the fast SystemJS s.js loader.</p>
<p>There is one optimization that we still need to implement though, and that is flattening all the dependencies to load at the same time instead of as a waterfall as they are loaded.</p>
<p>We can do this using the <code>jspm cast</code> optimization process.</p>
<p>Remove the previous <code>&lt;script src=<span class="string">"dist/app.js"</span>&gt;</code> script tag. Then lets use <code>jspm cast</code> to set up the page load for us:</p>
<pre><code>jspm cast -m app.html ./dist/app.js</code></pre>
<p>This tells jspm that we want to load the <code>./dist/app.js</code> file in the page, and it will then automatically put all the right script tags into the page.</p>
<ul>
<li>Each script tag will have integrity and cross-origin attributes added automatically (these can be disabled with <code>--no-integrity</code> or <code>--no-crossorigin</code>)</li>
<li>Only those scripts that load on initial page load are included</li>
<li>The scripts that are loaded with dynamic import are populated in a separate <code><span class="string">"integrity"</span></code> and <code><span class="string">"depcache"</span></code> attributes in the SystemJS import map.<br>This allows SystemJS to still avoid the dependency waterfall when clicking the button and also to continue to provide the integrity for those dynamic scripts.</li>
</ul>
<p><code>jspm cast</code> can be run again or with any other files. Each time it is run it will replace what was added before so you don't have to edit the HTML manually again.</p>
<p>If we want a smaller HTML output we can run:</p>
<pre><code>jspm cast -m app.html ./dist/app.js -M</code></pre>
<p>The <code>-M</code> flag tells jspm to minify the output import map, and applies to all import map altering commands.</p>
<h3>Next Steps</h3>
<p>That's the very quick overview of jspm 3.0. The CLI has other features and aspects which will be fleshed out further in future guides and API documentation.</p>
<p>Post your questions and feedback in the <strong>cli-beta</strong> discussion page on Discord.</p>
<blockquote>
<p>Reminder: While this work is still unreleased, please do not share any of this publicly.</p>
</blockquote>
<div class="nextprev"><a class="edit" target="_blank" href="https://github.com/jspm/jspm.org/blob/master/cli.md" rel="noopener">Edit</a><div class="prev"><a href="/jspm-dev-release">◀&nbsp;jspm.dev Release</a></div></div></div>


</body></html>